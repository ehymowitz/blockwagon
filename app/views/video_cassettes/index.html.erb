<%= render 'shared/carousel' %>

<%# Latest videocassettes %>
  <div class="container my-5">
    <h4><strong>Latest videocassettes added 😁</strong></h4>
  </div>
  <div class="d-flex" style="width:100%; overflow:auto">
    <%= render 'shared/vhs_scroll' %>
  </div>

<%# Popular section %>
  <div class="container my-5">
    <h4><strong>Most popular videocassette rentals ⭐</strong></h4>
  </div>

  <div class="d-flex" style="width:100%; overflow:auto">
    <% rentals = RentalRequest.where(status: "Pending") %>
    <% vids_rented = rentals.map { |rental| rental.video_cassette_id} %>
    <% most_rented = vids_rented.map { |id| VideoCassette.find(id) }%>

    <% most_rented.each do |video_cassette| %>
        <div class="card-small mx-2 homepage-card">
          <a href=<%= video_cassette_path(video_cassette) %>>
            <img class="cover-img" src="<%=video_cassette.cover_photo%>" alt="VHS cover">
          </a>

          <div class="card-small-info">
            <h5><strong><%= link_to video_cassette.title, video_cassette_path(video_cassette)%></strong></h5>
            <p><%= video_cassette.year %></p> <p><%= video_cassette.price %>.00$</p>
            <img src="<%=video_cassette.user.avatar%>" alt="User profile pic">
          </div>

        </div>
    <% end %>
    
  </div>

<%# Comedy section %>
  <div class="container my-5">
    <h4><strong>Looking for a good laugh? 😂</strong></h4>
  </div>
  <div class="d-flex" style="width:100%; overflow:auto">
    <% comedy = Genre.find_by(name: "comedy")%>
    <% tagged_comedy = VideoGenre.where(genre: comedy)%>
    <% array_id_comedy = tagged_comedy.limit(10).map { |tag| tag.video_cassette_id } %>
    <% video_comedy = array_id_comedy.map { |id| VideoCassette.find(id) }%>

    <% video_comedy.each do |video_cassette| %>
        <div class="card-small mx-2 homepage-card">
          <a href=<%= video_cassette_path(video_cassette) %>>
            <img class="cover-img" src="<%=video_cassette.cover_photo%>" alt="VHS cover">
          </a>

          <div class="card-small-info">
            <h5><strong><%= link_to video_cassette.title, video_cassette_path(video_cassette)%></strong></h5>
            <p><%= video_cassette.year %></p> <p><%= video_cassette.price %>.00$</p>
            <img src="<%=video_cassette.user.avatar%>" alt="User profile pic">
          </div>

        </div>
    <% end %>
    
  </div>

<%# Family section %>
  <div class="container my-5">
    <h4><strong>More into family-friendly VHS? 👪</strong></h4>
  </div>

  <div class="d-flex" style="width:100%; overflow:auto">
    <% family = Genre.find_by(name: "family")%>
    <% tagged_family = VideoGenre.where(genre: family)%>
    <% array_id_family = tagged_family.map { |tag| tag.video_cassette_id } %>
    <% video_family = array_id_family.map { |id| VideoCassette.find(id) }%>

    <% video_family.each do |video_cassette| %>
        <div class="card-small mx-2 homepage-card">
          <a href=<%= video_cassette_path(video_cassette) %>>
            <img class="cover-img" src="<%=video_cassette.cover_photo%>" alt="VHS cover">
          </a>

          <div class="card-small-info">
            <h5><strong><%= link_to video_cassette.title, video_cassette_path(video_cassette)%></strong></h5>
            <p><%= video_cassette.year %></p> <p><%= video_cassette.price %>.00$</p>
            <img src="<%=video_cassette.user.avatar%>" alt="User profile pic">
          </div>

        </div>
    <% end %>
  </div>

<%# Drama section %>
  <div class="container my-5">
    <h4><strong>Want some drama? 🙊</strong></h4>
  </div>

  <div class="d-flex mb-5" style="width:100%; overflow:auto">
    <% drama = Genre.find_by(name: "drama")%>
    <% tagged_drama = VideoGenre.where(genre: drama)%>
    <% array_id_drama = tagged_drama.map { |tag| tag.video_cassette_id } %>
    <% video_drama = array_id_drama.map { |id| VideoCassette.find(id) }%>

    <% video_drama.each do |video_cassette| %>
        <div class="card-small mx-2 homepage-card">
          <a href=<%= video_cassette_path(video_cassette) %>>
            <img class="cover-img" src="<%=video_cassette.cover_photo%>" alt="VHS cover">
          </a>

          <div class="card-small-info">
            <h5><strong><%= link_to video_cassette.title, video_cassette_path(video_cassette)%></strong></h5>
            <p><%= video_cassette.year %></p> <p><%= video_cassette.price %>.00$</p>
            <img src="<%=video_cassette.user.avatar%>" alt="User profile pic">
          </div>

        </div>
    <% end %>
  </div>
